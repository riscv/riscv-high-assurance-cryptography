[[ACE-constants]]
=== Constants

==== Error Codes

[.red]#(May still be incomplete.)#
In <<ACE-error-values>> we define the mandatory ACE error codes.
The range [0..127] is reserved for RVI.
Error codes specific to custom algorithms may be freely defined in the range [128..255], and are allowed to overlap between algorithms.

[[ACE-error-values]]
.Error values and their meanings
[float="center",align="center",width="100%",cols="^6%,<24%,<70%",options="header"]
|===
|Value | Mnemonic                  | Examples
|  0   | ace_err_ok                | All is fine. Life is beautiful. No error from ACE.
|  1   | ace_err_authentication    | Authentication failure in `ace.import`, but can also follow `ace.exec` with certain algorithms.
|  2   | ace_err_privilege         | `ace.exec`, `ace.stage`, `ace.derive`, `ace.spawn` failed because the access control policies in the metadata prevent USE in the current architectural state.
|  3   | ace_err_invalid           | Invalid input or operation. +
Examples:
the metadata section passed to `ace.init` is invalid;
encryption, resp., decryption is requested from a CC only configured for decryption, resp., encryption, and more generally
the current state of the CC does not expect the used form of `ace.exec`;
the requested change of state in `ace.stage` is not permitted;
the change in usage policies in `ace.restrict` is not permitted because it would either downgrade or overwrite the current restrictions in the CC;
a request to clone a CC violates the re-initialisation policies of the source CC;
software tried to use an incomplete CC as a source in a `ace.exec`, `ace.stage`, `ace.input`, `ace.output`, `ace.clone`, `ace.derive`, `ace.harden`, `ace.restrict` operations.
|  4   | ace_err_unimplemented     | The requested algorithm is not implemented. May be triggered also on algorithm variants, for instance if `ace.harden` is issued on an algorithm for which a non-side channel protected version is not implemented.
|  5   | ace_err_memory            | The free internal CF memory is not sufficient to perform the `ace.init`, `ace.exec`, `ace.clone`, or `ace.derive`.
The implementation should make sure this cannot happen with any other operation.
If algorithms that support `ace.derive` are implemented, the implementation must make sure that both the input and output CCs of this operation can be allocated.
|  6   | ace_err_unallocated_CC    | Software tried to use an unallocated CC as a source in a `ace.exec`, `ace.stage`, `ace.input`, `ace.output`, `ace.clone`, `ace.derive`, `ace.harden`, `ace.restrict` operations. +
This can be used in low CF memory situations to trigger a lazy re-load of that CC.
|===

==== Other Constants

[.red]#(May still be incomplete.)#
In addition to error codes, ACE defines several constants, such as
those in <<ACE-stage_constants>> which are used in `ace.stage`/`ace.dir` to change the state of a CC.
Note that the internal state machine of a CC may also be changed implicitly by `ace.exec` or `ace.derive` operations, and the state machine of a cloned CC may be changed implicitly according to the algorithm's policies as encoded in the source CC's metadata.

[[ACE-stage_constants]]
.Constants defining messages sent to a CC through `ace.stage`/`ace.dir` operations
[float="center",align="center",width="100%",cols="^6%,<29%,<65%",options="header"]
|===
|Value | Mnemonic                      | Examples
|  0   | ace_const_ok                  | All is fine. Life is beautiful. No error from ACE.
|  1   | ace_const_encrypt             | Encryption is requested.
|  2   | ace_const_decrypt             | Decryption is requested.
|  3   | ace_const_hash_start          | Start (and initialize) a hash function or the sub-function of an algorithm.
|  4   | ace_const_hash_finalize       | Finalize the internal state of a hash function and prepare it for outputting the result.
|  5   | ace_const_hash_update         | Update the internal state of a hash function with new data.
|  6   | ace_const_set_public_value    | Set a public value (like a nonce or an IV) in an algorithm. Some algorithms require more than one public value (for instance, they may admit a re-useable hash of some associated data and a unique nonce), in which case the second public value can be set using the next message.
|  7   | ace_const_set_public_value_2  | Set the second public value in an algorithm.
|===
