[[ACE-Instructions-Overview]]
=== Instructions Overview

The architecture provides a number of unprivileged instructions.
Some are implemented as CSR reads or writes.

.The ACE instructions
[width="100%",cols="16%,16%,68%",options="header"]
|===
| Instruction     | Operands                  |  Description
| `ace.enable` +
`ace.disable`     |                           |  Enables/Disables the feature in the current process domain and determine how many contexts we need. Pseudo-operation for a write to a WARL CSR.
| `ace.init`      | Cn\|Xn, [Xs]              |  Sets the algorithm and either the key or info on how to fetch and use system key (keystore).
| `ace.clear`     | Cn\|Xn                    |  Clears a CC and mark it as no longer in use and clean.
| `ace.export`    | [Xn], Cs\|Xs              |  Securely exports the content of a CC to memory.
| `ace.import`    | Cd\|Xd, [Xn], flag=system |  Authenticates and imports a SCC from memory into a CC. `ace import` can optionally support system defined blobs if the system flag == true.
| `ace.exec`
| A. {nbsp}{nbsp}Vd, Cn\|Xn, Vs +
  B. {nbsp}{nbsp}Cn\|Xn, Vs +
  C. {nbsp}{nbsp}Vd, Cn\|Xn +
  D. {nbsp}{nbsp}Cn\|Xn
| Performs a cryptographic operation such as an encryption or decryption, absorbing a value in a hash, and possibly returning a value. The instruction may also modify an internal state machine of the CC. This instruction admits four variants, depending on whether it accepts an input or not, and whether it produces an output or not.
| `ace.size`      | Xd, Cs\|Xs                |  Returns the size in bytes of the package exported from a specified CC.
| `ace.size`      | Xd, #immed                |  or from a specific algorithm given as #immed.
| `ace.clone`     | Cd\|Xd, Cs\|Xs            |  Clones a CC into a second CC.
| `ace.derive`    | Cd\|Xd, Cs\|Xs            |  Optional. Uses the source CC to configure the destination CC. Used if the source CC is, for instance, a KEM that configures the destination CC with a symmetric key. Then, the SW can clear the source CC to release resources.
| `ace.stage`     | Cn\|Xn, #immed            |  Triggers transitions in the state machine of the algorithm (such as the different stages of hash functions or modes of operation) or provide additional info.  `ace.dir` is an alias for `ace.stage`.
| `ace.input`     | Cd\|Xd, [Xs]              |  Optional. Provides an input to the algorithm configured in the CC `Cd` or `C[Xd]`, in place of providing it through the `ace.exec` instruction. Useful when the inputs are very long, such as the inputs to certain public key schemes. Mandatory only if required by some algorithms.
| `ace.output`    | [Xd], Cs\|Xs              |  Optional. Writes the output of an algorithm configured in the CC `Cs` or `C[Xs]`, in place of providing it through the `ace.exec` instruction. Useful when the outputs are very long, such as the outputs of certain public key schemes. Mandatory only if required by some algorithms.
| `ace.harden`    | Cd\|Xd, flags=level       |  Turns on or increases the level of the side-channel protection of the algorithm in the CC, if the microarchitecture supports it. Downgrading is not possible.
| `ace.restrict`  | Cd\|Xd, Xs                |  Optional. Narrows the Use policies of a CC.
| `ace.available` | #immed                    |  Informs whether a given primitive is supported by the microarchitecture.
| `ace.error`     | Xd, Cs\|Xs                |  A CC Cs (or indexed by Xs) may be in an error state due to the previous operation. The corresponding error value is written into GPR Xd.
|===
