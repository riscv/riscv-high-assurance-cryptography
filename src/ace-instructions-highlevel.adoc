[[ACE-Instructions-Overview]]
=== Instructions Overview

The architecture provides a number of unprivileged instructions.
Some are implemented as CSR reads or writes.
The non-standard notation `C[Xd]`, for a GPR Xd refers to the CC whose number is contained in `Xd`,
and `Cn|C[Xn]` means that there are two different encodings for when the operand is `Cn` or `C[Xn]`.

.The ACE instructions
[width="100%",cols="16%,24%,60%",options="header",subs="+macros"]
|===
| Instruction     | Operands                        |  Description
| `ace.enable` +
`ace.disable`     |                                 |  Enables/Disables the feature in the current process domain and determine how many contexts we need.  CSRW pseudo-operation.
| `ace.init`      | `Cd\|C[Xd], %offset(Xs)`         |  Sets the metadata and key(s) for the CC.
| `ace.clear`     | `Cd\|C[Xd]`                      |  Clears a CC and marks it as no longer in use and clean.
| `ace.export`    | `%offset(Xn), Cs\|C[Xs]`         |  Securely exports the content of a CC to memory.
| `ace.import` +
`ace.import.S`
| `Cd\|C[Xd], %offset(Xn)`      |  Authenticates and imports a SCC from memory into a CC. +
 `ace.import.S` provides optional support for system defined formats.
| `ace.exec`
| A. {nbsp}{nbsp} `Vd, Cn\|C[Xn], Vs` +
  B. {nbsp}{nbsp} `Cn\|C[Xn], Vs` +
  C. {nbsp}{nbsp} `Vd, Cn\|C[Xn]` +
  D. {nbsp}{nbsp} `Cn\|C[Xn]`
| Performs a cryptographic operation such as an encryption or decryption, absorbing a value in a hash. The instruction may also modify the internal state of the CC. This instruction admits four _forms_, depending on whether it accepts an input or not, and whether it produces an output or not.
| `ace.size`
| `Xd, Cs\|C[Xs]` +
 `Xd, Xs`          |  Returns the size in bytes of the package exported from a specified CC, or from a metadata block.
| `ace.available` | `#immed`                        |  Informs whether a given algorithm is supported by the microarchitecture.
| `ace.clone`     | `Cd\|C[Xd], Cs\|C[Xs]`            |  Clones a CC into a second CC.
| `ace.derive`    | `Cd\|C[Xd], Cs\|C[Xs]`            |  Optional. Uses the source CC to configure the destination CC. Used if the source CC is, for instance, a KEM that configures the destination CC with a symmetric key. Then, the SW can clear the source CC to release resources.
| `ace.stage`     | `Cd\|C[Xd], #immed`              |  Triggers transitions in the state of the algorithm (such as the different stages of hash functions or modes of operation) or provide additional info.  `ace.dir` is an alias for `ace.stage`.
| `ace.restrict`
  `ace.harden`    | `Cd\|C[Xd], Xs`                  |  This instruction is used to narrow the Use policies of a CC and to turn on or increases the level of the side-channel protection of the algorithm in the CC, if the microarchitecture supports it.
  Removing or weakening existing Use Policies and reducing the level of side-channel protection are not permitted.
| `ace.input`     | `Cd\|C[Xd], %offset(Xs)`         |  Optional. Provides an input to the algorithm configured in the CC `Cd` or `CC[Xd]`, in place of providing it through the `ace.exec` instruction. Useful when the inputs are very long, such as the inputs to certain public key schemes. Mandatory only if required by some algorithms.
| `ace.output`    | `%offset(Xd), Cs\|C[Xs]`         |  Optional. Writes the output of an algorithm configured in the CC `Cs` or `CC[Xs]`, in place of providing it through the `ace.exec` instruction. Useful when the outputs are very long, such as the outputs of certain public key schemes. Mandatory only if required by some algorithms.
| `ace.error`     | `Xd, Cs\|C[Xs]`                  |  A CC Cs (or indexed by Xs) may be in an error state due to the previous operation. The error value is written into GPR Xd.
|===
