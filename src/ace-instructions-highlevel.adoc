[[Instructions-Overview]]
=== Instructions Overview

The architecture provides a number of instructions, some of which can simply be implemented as CSR reads or writes.

.The ACE instructions
[width="100%",cols="16%,16%,68%",options="header",frame=ends, grid=rows]
|===
| Instruction     | Operands                  |  Description
| `ace.enable` +
`ace.disable`     |                           |  Enable/Disable the feature in the current process domain and determine how many contexts we need. Pseudo-operation for a write to a WARL CSR.
| `ace.init`      | Cn\|Xn, [Xs]              |  Sets the algorithm and either the key or info on how to fetch and use system key (keystore).
| `ace.clear`     | Cn\|Xn                    |  Clear a CC and mark it as no longer in use (both in the CC internal table and in the feature CSR).
| `ace.size`      | Xd, Cs\|Xs                |  Returns the size in bytes of the package exported from a specified CC,
| `ace.size`      | Xd, #immed                |  or from a specific algorithm given as #immed (including the side channel bit).
| `ace.export`    | [Xn], Cs\|Xs              |  Exports the content of a CC to an encrypted and authenticated package to memory. Remember that there is no "save" instruction to extract key and all metadata in the clear.
| `ace.import`    | Cd\|Xd, [Xn], flag=system |  Reads an encrypted and authenticated package from memory and imports it into a CC if ok. ace import can also provide import for system defined blobs or connect a context to an entry of an Immutable System Key table (which is usually inaccessible to SW environments) if the system flag == true.
| `ace.exec`
|(i){nbsp}{nbsp}Vd, Cn\|Xn, Vs +
(ii){nbsp}{nbsp}Cn\|Xn, Vs +
(iii){nbsp}{nbsp}Vd, Cn\|Xn +
(iv){nbsp}{nbsp}Cn\|Xn
| Performs a cryptographic operation such as an encryption or decryption, absorbing a value in a hash, and possibly returning a value. The instruction may also modify an internal state machine of the CC. This instruction admits four variants:
(i) accepts an input and produces an output,
(ii) accepts an input but produces no output,
(iii) accepts no input but produces an output,
(iv) accepts no input and produces no output.
| `ace.input`     | Cd\|Xd, [Xs]              |  Optional. Provides an input to the algorithm configured in the CC `Cd` or `C[Xd]`, in place of providing it through the `ace.exec` instruction. Useful when the inputs are very long, such as the inputs to certain public key schemes. Mandatory only if required by some algorithms.
| `ace.output`    | [Xd], Cs\|Xs              |  Optional. Writes the output of an algorithm configured in the CC `Cs` or `C[Xs]`, in place of providing it through the `ace.exec` instruction. Useful when the outputs are very long, such as the outputs of certain public key schemes. Mandatory only if required by some algorithms.
| `ace.stage`     | Cn\|Xn, #immed            | Changes the stage of a multi-stage function (such as hash functions or modes of operation) or provide additional info.  For instance, for  block cipher/mode of operation keys it also sets encryption / decryption. +
`ace.dir` is an alias for `ace.stage`.
//| `ace.dir`       | Cn\|Xn, #immed
| `ace.available` | #immed                    |  Informs whether a given primitive is supported by the Âµarchitecture.
| `ace.error`     | Xd, Cn\|Xn                |  Returns the error of an operation. Can be implemented as a CSRs read.
| `ace.clone`     | Cd\|Xd, Cs\|Xs            |  Clones a CC into a second CC.
| `ace.harden`    | Cd\|Xd, flags=level       |  If possible, turn the CC into a side-channel protected version according to the flags. Downgrade is never allowed.
| `ace.spawn`     | Cd\|Xd, Cs\|Xs            |  Optional. Uses the source CC to configure the destination CC. Used if the source CC is, for instance, a KEM that configures the destination CC with a symmetric key. Then, the SW can clear the source CC to release resources.
| `ace.restrict`  | Cd\|Xd, Xs                |  Optional. Can be used to prevent the use of a CC to specific modes, and to restrict the use of a CC to a specified `ASID` or `VMID` if not previously specified.
|===
